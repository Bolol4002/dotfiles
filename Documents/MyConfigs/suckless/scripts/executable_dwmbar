#!/bin/bash

# Function to get battery percentage
get_battery() {
    # Check if battery exists
    if [ -d "/sys/class/power_supply/BAT0" ]; then
        capacity=$(cat /sys/class/power_supply/BAT0/capacity)
        status=$(cat /sys/class/power_supply/BAT0/status)
        if [ "$status" = "Charging" ]; then
            echo "BAT: ${capacity}%+"
        else
            echo "BAT: ${capacity}%"
        fi
    else
        echo "BAT: N/A"
    fi
}

# Function to get volume level
get_volume() {
    # Using pactl for PulseAudio (you can modify for ALSA if needed)
    vol=$(pactl list sinks | grep 'Volume: front-left' | awk '{print $5}' | tr -d '%')
    mute=$(pactl list sinks | grep 'Mute:' | awk '{print $2}')
    if [ "$mute" = "yes" ]; then
        echo "VOL: Muted"
    else
        echo "VOL: ${vol}%"
    fi
}

# Function to get CPU usage
get_cpu() {
    # Calculate CPU usage since last check
    cpu=$(top -bn1 | grep "Cpu(s)" | awk '{print $2 + $4}' | cut -d. -f1)
    echo "CPU: ${cpu}%"
}

# Function to get RAM usage
get_ram() {
    # Get total and used memory from 'free' command
    ram_total=$(free -m | awk '/Mem:/ {print $2}')
    ram_used=$(free -m | awk '/Mem:/ {print $3}')
    # Calculate percentage
    ram_percent=$((ram_used * 100 / ram_total))
    echo "RAM: ${ram_percent}%"
}

# Main loop to update status bar
while true; do
    # Get all values
    battery=$(get_battery)
    volume=$(get_volume)
    cpu=$(get_cpu)
    ram=$(get_ram)
    datetime=$(date "+%Y-%m-%d %H:%M")

    # Set the status bar text
    xsetroot -name "$cpu | $ram | $volume | $battery | $datetime"
    
    # Update every 5 seconds
    sleep 5
done
